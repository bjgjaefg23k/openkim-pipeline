

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>models &mdash; OpenKIM Pipeline 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpenKIM Pipeline 0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">OpenKIM Pipeline 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for models</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot; A pure python object wrapper for the pipeline stuff</span>

<span class="sd">What we would like is a nice way to create an manipulate the items in the database</span>

<span class="sd">Things we need to be able to do:</span>
<span class="sd">    * create test results</span>
<span class="sd">    * look up test results for test model pairs</span>
<span class="sd">    * look up current versions of kim objects</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s">&quot;models&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">persistentdict</span> <span class="kn">import</span> <span class="n">PersistentDict</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">template</span>
<span class="kn">import</span> <span class="nn">database</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">dircache</span>
<span class="kn">import</span> <span class="nn">simplejson</span>
<span class="kn">import</span> <span class="nn">kimapi</span>

<span class="c">#------------------------------------------------</span>
<span class="c"># Base KIMObject </span>
<span class="c">#------------------------------------------------</span>

<div class="viewcode-block" id="KIMObject"><a class="viewcode-back" href="../pipeline.html#models.KIMObject">[docs]</a><span class="k">class</span> <span class="nc">KIMObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The base KIMObject that all things inherit from</span>
<span class="sd">    </span>
<span class="sd">    KIMObjects live in memory, and have the following things:</span>
<span class="sd">        * path - directory they are stored</span>
<span class="sd">        * kim_code - their kim code</span>
<span class="sd">        * kim_code_leader - two letter prefix</span>
<span class="sd">        * kim_code_number - their id number (12 digits)</span>
<span class="sd">        * kim_code_version - 3 digit version number</span>
<span class="sd">        * info - some metadata stored in a json file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">,</span><span class="n">search</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize a KIMObject given the kim_code, where partial kim codes are promoted if possible,</span>
<span class="sd">            if search is False, then don&#39;t look for existing ones </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Initializing a new KIMObject: </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">kim_code</span><span class="p">)</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">leader</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">parse_kim_code</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>
       
        <span class="c"># test to see if we have the right leader</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_leader</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">leader</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">required_leader</span><span class="p">,</span><span class="s">&quot;{} not a valid KIM code for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kim_code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        
        <span class="c">#grab the attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_leader</span> <span class="o">=</span> <span class="n">leader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_number</span> <span class="o">=</span> <span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_version</span> <span class="o">=</span> <span class="n">version</span>
       
        <span class="k">if</span> <span class="ow">not</span> <span class="n">search</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span> <span class="o">=</span> <span class="n">kim_code</span>
        <span class="c">#if we were given everything, we are good to go</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">leader</span> <span class="ow">and</span> <span class="n">num</span> <span class="ow">and</span> <span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">format_kim_code</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>
        
        <span class="c">#if we weren&#39;t given a name, see if one exists</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">leader</span> <span class="ow">and</span> <span class="n">num</span> <span class="ow">and</span> <span class="n">version</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">look_for_name</span><span class="p">(</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">format_kim_code</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>
        
        <span class="c">#if we weren&#39;t given a version</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">leader</span> <span class="ow">and</span> <span class="n">num</span> <span class="ow">and</span> <span class="n">version</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get_latest_version</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_version</span> <span class="o">=</span> <span class="n">version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">format_kim_code</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>

        <span class="c">#if we weren&#39;t given a name or version</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">leader</span> <span class="ow">and</span> <span class="n">num</span> <span class="ow">and</span> <span class="n">version</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get_latest_version</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_version</span> <span class="o">=</span> <span class="n">version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">format_kim_code</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">KIM_REPOSITORY_DIR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_leader</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dir</span> <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">PersistentDict</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">METADATA_INFO_FILE</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;{}({})&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span>  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Object is true if it exists &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="KIMObject.exists"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tells you whether the path exists or not &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="KIMObject.create_dir"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.create_dir">[docs]</a>    <span class="k">def</span> <span class="nf">create_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If this thing doesn&#39;t exist create it&#39;s directories &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="KIMObject.get_latest_version_number"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.get_latest_version_number">[docs]</a>    <span class="k">def</span> <span class="nf">get_latest_version_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Figure out the latest version number &quot;&quot;&quot;</span>
        <span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get_latest_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kim_code_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_leader</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kim_code_number</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">version</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="KIMObject.latest_version"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.latest_version">[docs]</a>    <span class="k">def</span> <span class="nf">latest_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the latest version object of this thing &quot;&quot;&quot;</span>
        <span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get_latest_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kim_code_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_leader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_number</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">format_kim_code</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span><span class="p">))</span>
    </div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="KIMObject.is_latest_version"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.is_latest_version">[docs]</a>    <span class="k">def</span> <span class="nf">is_latest_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tells whether this is the latest version in the database &quot;&quot;&quot;</span>
        <span class="n">myversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code_version</span>
        <span class="n">newestversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_version_number</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">myversion</span> <span class="o">==</span> <span class="n">newestversion</span>
</div>
<div class="viewcode-block" id="KIMObject.sync"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.sync">[docs]</a>    <span class="k">def</span> <span class="nf">sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sync the info file &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>
</div>
    <span class="nd">@contextmanager</span>
<div class="viewcode-block" id="KIMObject.in_dir"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.in_dir">[docs]</a>    <span class="k">def</span> <span class="nf">in_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; a context manager to do things inside this objects path &quot;&quot;&quot;</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;moved to dir: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">yield</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="KIMObject.make"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.make">[docs]</a>    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Try to build the thing &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeable</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dir</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Attempting to make </span><span class="si">%r</span><span class="s">: </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="s">&#39;make&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s">:</span><span class="si">%r</span><span class="s"> is not makeable&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="KIMObject.makefile"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.makefile">[docs]</a>    <span class="k">def</span> <span class="nf">makefile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A file object for the make file &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeable</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;Makefile&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s">:</span><span class="si">%r</span><span class="s"> is not makeable&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="KIMObject.all"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.all">[docs]</a>    <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a generator of all of this type &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Attempting to find all </span><span class="si">%r</span><span class="s">...&quot;</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">type_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">KIM_REPOSITORY_DIR</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">required_leader</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="p">)</span> 
        <span class="n">kim_codes</span> <span class="o">=</span>  <span class="p">(</span> <span class="n">subpath</span> <span class="k">for</span> <span class="n">subpath</span> <span class="ow">in</span> <span class="n">dircache</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">type_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">type_dir</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">cls</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">kim_codes</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="KIMObject.delete"><a class="viewcode-back" href="../pipeline.html#models.KIMObject.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete the folder for this object &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;REMOVING the kim object </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

<span class="c">#---------------------------------------------</span>
<span class="c"># Actual KIM Models</span>
<span class="c">#---------------------------------------------</span>


<span class="c">#---------------------------------------------</span>
<span class="c"># Test</span>
<span class="c">#---------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="Test"><a class="viewcode-back" href="../pipeline.html#models.Test">[docs]</a><span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A kim test, it is a KIMObject, plus</span>
<span class="sd">    </span>
<span class="sd">        * executable - a path to its executable</span>
<span class="sd">        * in_file - it&#39;s infile</span>
<span class="sd">        * out_file - out_file dictionary</span>
<span class="sd">        * test_driver - which test driver it relies on</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;TE&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the Test, with a kim_code &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outfile_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">OUTPUT_FILE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infile_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">INPUT_FILE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outfile_to_dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dir</span><span class="p">():</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_reversed_out_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reverses the out_dict &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span> <span class="n">value</span><span class="p">:</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="p">}</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Test.infile"><a class="viewcode-back" href="../pipeline.html#models.Test.infile">[docs]</a>    <span class="k">def</span> <span class="nf">infile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return a file object for the in file &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile_path</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Test.outfile"><a class="viewcode-back" href="../pipeline.html#models.Test.outfile">[docs]</a>    <span class="k">def</span> <span class="nf">outfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return a file object for the out file &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile_path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test.dependency_check"><a class="viewcode-back" href="../pipeline.html#models.Test.dependency_check">[docs]</a>    <span class="k">def</span> <span class="nf">dependency_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Ask template.py to do a dependency check</span>
<span class="sd">            returns a 3 tuple</span>
<span class="sd">                ready - bool of whether good to go or not</span>
<span class="sd">                dependencies_good_to_go - kids for ready dependencies</span>
<span class="sd">                dependencies_not_ready - tuples of test/model pairs to run &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">dependency_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Test.dependencies"><a class="viewcode-back" href="../pipeline.html#models.Test.dependencies">[docs]</a>    <span class="k">def</span> <span class="nf">dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of kim objects that are its dependencies &quot;&quot;&quot;</span>
        <span class="n">ready</span><span class="p">,</span> <span class="n">goods</span><span class="p">,</span> <span class="n">bads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependency_check</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">goods</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kim_code</span> <span class="ow">in</span> <span class="n">goods</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">kim_obj</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bads</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kim1</span><span class="p">,</span> <span class="n">kim2</span> <span class="ow">in</span> <span class="n">bads</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">kim_obj</span><span class="p">(</span><span class="n">kim1</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">kim_obj</span><span class="p">(</span><span class="n">kim2</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Test.test_drivers"><a class="viewcode-back" href="../pipeline.html#models.Test.test_drivers">[docs]</a>    <span class="k">def</span> <span class="nf">test_drivers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of test drivers this guy relies on &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">depend</span> <span class="k">for</span> <span class="n">depend</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span> <span class="k">if</span> <span class="n">depend</span><span class="o">.</span><span class="n">required_leader</span> <span class="o">==</span> <span class="s">&quot;TD&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Test.results"><a class="viewcode-back" href="../pipeline.html#models.Test.results">[docs]</a>    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Give a list of all of the results of this test &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">result</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">TestResult</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">test</span> <span class="o">==</span> <span class="bp">self</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="Test.result_with_model"><a class="viewcode-back" href="../pipeline.html#models.Test.result_with_model">[docs]</a>    <span class="k">def</span> <span class="nf">result_with_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the first result with the model: model, or None &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span> <span class="n">result</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="n">model</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PipelineDataMissing</span><span class="p">,</span> <span class="s">&quot;Could not find a TestResult for ({}, {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
    </div>
    <span class="k">def</span> <span class="nf">_outfile_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert the output file to a dict &quot;&quot;&quot;</span>
        <span class="n">outdata</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile_path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">outdata</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">front</span><span class="p">,</span><span class="n">back</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span> <span class="n">front</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">:</span> <span class="n">back</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">})</span>
        <span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="Test.processed_infile"><a class="viewcode-back" href="../pipeline.html#models.Test.processed_infile">[docs]</a>    <span class="k">def</span> <span class="nf">processed_infile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Process the input file, with template, and return a file object to the result &quot;&quot;&quot;</span>
        <span class="n">template</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">kim_code</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">TEMP_INPUT_FILE</span><span class="p">))</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Test.models"><a class="viewcode-back" href="../pipeline.html#models.Test.models">[docs]</a>    <span class="k">def</span> <span class="nf">models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a generator of valid matched models &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">model</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">Model</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="n">kimapi</span><span class="o">.</span><span class="n">valid_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">model</span><span class="p">)</span> <span class="p">)</span>


<span class="c">#--------------------------------------</span>
<span class="c"># Model</span>
<span class="c">#-------------------------------------</span>
</div></div>
<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../pipeline.html#models.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A KIM Model &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;MO&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the Model, with a kim_code &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Model.model_driver"><a class="viewcode-back" href="../pipeline.html#models.Model.model_driver">[docs]</a>    <span class="k">def</span> <span class="nf">model_driver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the model driver if there is one, otherwise None &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ModelDriver</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">makefile</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;MODEL_DRIVER_NAME&quot;</span><span class="p">)</span> <span class="p">))</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Model.results"><a class="viewcode-back" href="../pipeline.html#models.Model.results">[docs]</a>    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get all of the results &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">result</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">TestResult</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="bp">self</span> <span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Model.tests"><a class="viewcode-back" href="../pipeline.html#models.Model.tests">[docs]</a>    <span class="k">def</span> <span class="nf">tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a generator of the tests that match this model &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">test</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">Test</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="n">kimapi</span><span class="o">.</span><span class="n">valid_match</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span> <span class="p">)</span>


<span class="c">#-------------------------------------</span>
<span class="c"># TestResult</span>
<span class="c">#-------------------------------------</span>
</div></div>
<div class="viewcode-block" id="TestResult"><a class="viewcode-back" href="../pipeline.html#models.TestResult">[docs]</a><span class="k">class</span> <span class="nc">TestResult</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A test result &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;TR&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kim_code</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">pair</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the TestResult, with a kim_code,</span>
<span class="sd">                or a (test,model) pair,</span>
<span class="sd">                optionally, take a JSON string and store it &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">pair</span> <span class="ow">and</span> <span class="n">kim_code</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxWarning</span><span class="p">,</span> <span class="s">&quot;TestResult should have a pair, or a kim_code or neither, not both&quot;</span>
        
        <span class="k">if</span> <span class="n">pair</span><span class="p">:</span>
            <span class="n">test</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">pair</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">result_with_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="n">kim_code</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">kim_code</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kim_code</span><span class="p">:</span>
                <span class="n">kim_code</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">new_test_result_id</span><span class="p">()</span>
                <span class="n">search</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="nb">super</span><span class="p">(</span><span class="n">TestResult</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">,</span><span class="n">search</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">search</span><span class="p">:</span>
            <span class="c">#If this TR doesn&#39;t exist and we have search off, create it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_dir</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">PersistentDict</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">),</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">)</span>
        <span class="c">#if we recieved a json string, write it out</span>
        <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Recieved results, writing out to </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                <span class="c">#we have a dict</span>
                <span class="n">incoming_results</span> <span class="o">=</span> <span class="n">results</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="c">#if it is a json string try to convert it</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">incoming_results</span> <span class="o">=</span> <span class="n">simplejson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="c">#wasn&#39;t convertable</span>
                    <span class="k">raise</span> <span class="n">PipelineResultsError</span><span class="p">,</span> <span class="s">&quot;Could not understand the format of the results: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
            
            <span class="c">#also move all of the files</span>
            <span class="n">testname</span> <span class="o">=</span> <span class="n">incoming_results</span><span class="p">[</span><span class="s">&quot;_testname&quot;</span><span class="p">]</span>

            <span class="n">files</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">files_from_results</span><span class="p">(</span><span class="n">incoming_results</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;found files to move&quot;</span><span class="p">)</span>
                <span class="n">testdir</span> <span class="o">=</span> <span class="n">Test</span><span class="p">(</span><span class="n">testname</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
                <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;copying </span><span class="si">%r</span><span class="s"> over&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">testdir</span><span class="p">,</span><span class="n">src</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">incoming_results</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Results created in </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">Test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s">&quot;_testname&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s">&quot;_modelname&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="TestResult.sync"><a class="viewcode-back" href="../pipeline.html#models.TestResult.sync">[docs]</a>    <span class="k">def</span> <span class="nf">sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sync not only the info file but also the results &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="TestResult.files"><a class="viewcode-back" href="../pipeline.html#models.TestResult.files">[docs]</a>    <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A list of all of the files in the test_result &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span><span class="n">template</span><span class="o">.</span><span class="n">files_from_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">))</span>
    </div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="TestResult.full_file_paths"><a class="viewcode-back" href="../pipeline.html#models.TestResult.full_file_paths">[docs]</a>    <span class="k">def</span> <span class="nf">full_file_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Files with a full path &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="TestResult.file_handlers"><a class="viewcode-back" href="../pipeline.html#models.TestResult.file_handlers">[docs]</a>    <span class="k">def</span> <span class="nf">file_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return file handlers for all of the files &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_file_paths</span> <span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_is_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tells whether a key is a property or not &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">RE_KIMID</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="TestResult.property_codes"><a class="viewcode-back" href="../pipeline.html#models.TestResult.property_codes">[docs]</a>    <span class="k">def</span> <span class="nf">property_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of all property codes computed in this test result &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_property</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>    
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="TestResult.predictions"><a class="viewcode-back" href="../pipeline.html#models.TestResult.predictions">[docs]</a>    <span class="k">def</span> <span class="nf">predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a dictionary with kim Property objects pointing to the results &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span> <span class="n">Property</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">property_codes</span> <span class="p">}</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="TestResult.properties"><a class="viewcode-back" href="../pipeline.html#models.TestResult.properties">[docs]</a>    <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of properties &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">Property</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">property_codes</span> <span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Make it so that results behave like their result dictionary for access &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; if we didn&#39;t find the attr, look in self.results &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="TestResult.test_result_exists"><a class="viewcode-back" href="../pipeline.html#models.TestResult.test_result_exists">[docs]</a>    <span class="k">def</span> <span class="nf">test_result_exists</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check to see if the test result exists &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cls</span><span class="p">(</span><span class="n">pair</span><span class="o">=</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">model</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">PipelineDataMissing</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="TestResult.duplicates"><a class="viewcode-back" href="../pipeline.html#models.TestResult.duplicates">[docs]</a>    <span class="k">def</span> <span class="nf">duplicates</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of all of the duplicated results &quot;&quot;&quot;</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pairs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>







<span class="c">#------------------------------------------</span>
<span class="c"># TestDriver</span>
<span class="c">#------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="TestDriver"><a class="viewcode-back" href="../pipeline.html#models.TestDriver">[docs]</a><span class="k">class</span> <span class="nc">TestDriver</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A test driver &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;TD&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the TestDriver, with a kim_code &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestDriver</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dir</span><span class="p">():</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="TestDriver.tests"><a class="viewcode-back" href="../pipeline.html#models.TestDriver.tests">[docs]</a>    <span class="k">def</span> <span class="nf">tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of tests &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">test</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">Test</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">dependencies</span> <span class="p">)</span>


<span class="c">#------------------------------------------</span>
<span class="c"># ModelDriver</span>
<span class="c">#------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="ModelDriver"><a class="viewcode-back" href="../pipeline.html#models.ModelDriver">[docs]</a><span class="k">class</span> <span class="nc">ModelDriver</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A model driver &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;MD&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the ModelDriver, with a kim_code &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ModelDriver</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="ModelDriver.models"><a class="viewcode-back" href="../pipeline.html#models.ModelDriver.models">[docs]</a>    <span class="k">def</span> <span class="nf">models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return all of the models using this model driver &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">model</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">Model</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">==</span><span class="n">model</span><span class="o">.</span><span class="n">model_driver</span> <span class="p">)</span>


<span class="c">#------------------------------------------</span>
<span class="c"># Property</span>
<span class="c">#------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="Property"><a class="viewcode-back" href="../pipeline.html#models.Property">[docs]</a><span class="k">class</span> <span class="nc">Property</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A kim property &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;PR&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the Property, with a kim_code &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Property</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Property.results"><a class="viewcode-back" href="../pipeline.html#models.Property.results">[docs]</a>    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of results that compute this property &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">tr</span> <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">TestResult</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">tr</span><span class="o">.</span><span class="n">properties</span> <span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Property.data"><a class="viewcode-back" href="../pipeline.html#models.Property.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the data in this thing &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Property.references"><a class="viewcode-back" href="../pipeline.html#models.Property.references">[docs]</a>    <span class="k">def</span> <span class="nf">references</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a generator of references that reference this property &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">rd</span> <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">ReferenceDatum</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">rd</span><span class="o">.</span><span class="n">property</span> <span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Property.tags"><a class="viewcode-back" href="../pipeline.html#models.Property.tags">[docs]</a>    <span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a generator of all the tags used by the test writers to refer to this property &quot;&quot;&quot;</span> 
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">_reversed_out_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">Property</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="p">)</span>

    

<span class="c">#------------------------------------------</span>
<span class="c"># VerificationCheck</span>
<span class="c">#------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="VerificationCheck"><a class="viewcode-back" href="../pipeline.html#models.VerificationCheck">[docs]</a><span class="k">class</span> <span class="nc">VerificationCheck</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A verification check &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;VC&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the VerificationCheck, with a kim_code &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VerificationCheck</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kim_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_dir</span><span class="p">():</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c">#------------------------------------------</span>
<span class="c"># VerificationResult</span>
<span class="c">#------------------------------------------</span>
</div>
<div class="viewcode-block" id="VerificationResult"><a class="viewcode-back" href="../pipeline.html#models.VerificationResult">[docs]</a><span class="k">class</span> <span class="nc">VerificationResult</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A verification result &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;VR&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the VerificationResult, with a kim_code &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VerificationResult</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>


<span class="c">#------------------------------------------</span>
<span class="c"># ReferenceDatum</span>
<span class="c">#------------------------------------------</span>
</div>
<div class="viewcode-block" id="ReferenceDatum"><a class="viewcode-back" href="../pipeline.html#models.ReferenceDatum">[docs]</a><span class="k">class</span> <span class="nc">ReferenceDatum</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; a piece of reference data &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;RD&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the ReferenceDatum, with a kim_code &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReferenceDatum</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>

<span class="c">#------------------------------------------</span>
<span class="c"># VirtualMachine</span>
<span class="c">#------------------------------------------</span>
</div>
<div class="viewcode-block" id="VirtualMachine"><a class="viewcode-back" href="../pipeline.html#models.VirtualMachine">[docs]</a><span class="k">class</span> <span class="nc">VirtualMachine</span><span class="p">(</span><span class="n">KIMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; for a virtual machine &quot;&quot;&quot;</span>
    <span class="n">required_leader</span> <span class="o">=</span> <span class="s">&quot;VM&quot;</span>
    <span class="n">makeable</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kim_code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize a VirtualMachine with a kim_code &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VirtualMachine</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>


<span class="c"># two letter codes to the associated class</span></div>
<span class="n">code_to_model</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;TE&quot;</span><span class="p">:</span> <span class="n">Test</span><span class="p">,</span> <span class="s">&quot;MO&quot;</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="s">&quot;TD&quot;</span><span class="p">:</span> <span class="n">TestDriver</span><span class="p">,</span> <span class="s">&quot;TR&quot;</span><span class="p">:</span> <span class="n">TestResult</span> <span class="p">,</span> <span class="s">&quot;VC&quot;</span><span class="p">:</span> <span class="n">VerificationCheck</span><span class="p">,</span> <span class="s">&quot;VR&quot;</span><span class="p">:</span> <span class="n">VerificationResult</span><span class="p">,</span> <span class="s">&quot;RD&quot;</span><span class="p">:</span> <span class="n">ReferenceDatum</span><span class="p">,</span> <span class="s">&quot;PR&quot;</span><span class="p">:</span> <span class="n">Property</span> <span class="p">,</span> <span class="s">&quot;VM&quot;</span><span class="p">:</span> <span class="n">VirtualMachine</span><span class="p">,</span> <span class="s">&quot;MD&quot;</span><span class="p">:</span> <span class="n">ModelDriver</span> <span class="p">}</span>

<div class="viewcode-block" id="kim_obj"><a class="viewcode-back" href="../pipeline.html#models.kim_obj">[docs]</a><span class="k">def</span> <span class="nf">kim_obj</span><span class="p">(</span><span class="n">kim_code</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Just given a kim_code try to make the right object &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">,</span><span class="n">leader</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">version</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">parse_kim_code</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>
    <span class="n">cls</span> <span class="o">=</span> <span class="n">code_to_model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">leader</span><span class="p">,</span> <span class="n">KIMObject</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">kim_code</span><span class="p">)</span>


</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">(</span><span class="s">&quot;TR_127663948908_000&quot;</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">OpenKIM Pipeline 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Alex Alemi, Matt Bierbaum, Woosong Choi, James P. Sethna.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>